-------------------------------------------
-- TUESDAY EXERCISES
-------------------------------------------

-- A
CREATE TABLE INVOICE (
    INVOICE_ID NUMBER(15) CONSTRAINT PK_INV PRIMARY KEY,
    INVOICE_DATE DATE,
    CUSTOMER_ID NUMBER(2),
    AMOUNT NUMBER(11,2) --everything at store is under a million dollars
);

-- B
CREATE TABLE CUSTOMER (
    CUSTOMER_ID NUMBER(2) CONSTRAINT PK_CUST PRIMARY KEY,
    CUSTOMER_NAME VARCHAR2(60),
    EMAIL_ADDRESS VARCHAR2(50),
    PHONE_NUMBER VARCHAR2(10)
);

-- C
ALTER TABLE INVOICE
ADD CONSTRAINT FK_INV_ID
FOREIGN KEY (CUSTOMER_ID) REFERENCES CUSTOMER ON DELETE SET NULL;

-- D
INSERT INTO CUSTOMER (CUSTOMER_ID, CUSTOMER_NAME, EMAIL_ADDRESS, PHONE_NUMBER) VALUES (10, 'Hadlee Goodacre', 'hgoodacre0@vkontakte.ru', '7176130778');
INSERT INTO CUSTOMER (CUSTOMER_ID, CUSTOMER_NAME, EMAIL_ADDRESS, PHONE_NUMBER) VALUES (11, 'Sabrina Victory', 'svictory1@whitehouse.gov', '8584651961');
INSERT INTO CUSTOMER (CUSTOMER_ID, CUSTOMER_NAME, EMAIL_ADDRESS, PHONE_NUMBER) VALUES (12, 'Marketa Wordley', 'mwordley2@xing.com', '2475574375');
INSERT INTO CUSTOMER (CUSTOMER_ID, CUSTOMER_NAME, EMAIL_ADDRESS, PHONE_NUMBER) VALUES (13, 'Trevor Tilford', 'ttilford3@sfgate.com', '1391146204');
INSERT INTO CUSTOMER (CUSTOMER_ID, CUSTOMER_NAME, EMAIL_ADDRESS, PHONE_NUMBER) VALUES (14, 'Genny Walklot', 'gwalklot4@apple.com', '8685112220');
INSERT INTO CUSTOMER (CUSTOMER_ID, CUSTOMER_NAME, EMAIL_ADDRESS, PHONE_NUMBER) VALUES (15, 'Constanta Klasing', 'cklasing5@trellian.com', '3286675811');
INSERT INTO CUSTOMER (CUSTOMER_ID, CUSTOMER_NAME, EMAIL_ADDRESS, PHONE_NUMBER) VALUES (16, 'Beverlee Fanton', 'bfanton6@google.pl', '6494637067');
INSERT INTO CUSTOMER (CUSTOMER_ID, CUSTOMER_NAME, EMAIL_ADDRESS, PHONE_NUMBER) VALUES (17, 'Daniel Dabel', 'ddabel7@google.com.hk', '7504704802');
INSERT INTO CUSTOMER (CUSTOMER_ID, CUSTOMER_NAME, EMAIL_ADDRESS, PHONE_NUMBER) VALUES (18, 'Bronson Balk', 'bbalk8@seattletimes.com', '7206692882');
INSERT INTO CUSTOMER (CUSTOMER_ID, CUSTOMER_NAME, EMAIL_ADDRESS, PHONE_NUMBER) VALUES (19, 'Novelia Reddecliffe', 'nreddecliffe9@phoca.cz', '1537410973');

INSERT INTO CUSTOMER (INVOICE_ID, INVOICE_DATE, CUSTOMER_ID, AMOUNT) VALUES (653765330560921, DATE '1964-07-01', 19, 219710.9);
INSERT INTO INVOICE (INVOICE_ID, INVOICE_DATE, CUSTOMER_ID, AMOUNT) VALUES (389681869848649, DATE '1996-07-13', 18, 344596.61);
INSERT INTO INVOICE (INVOICE_ID, INVOICE_DATE, CUSTOMER_ID, AMOUNT) VALUES (355485935441424, DATE '2000-01-15', 10, 139480.59);
INSERT INTO INVOICE (INVOICE_ID, INVOICE_DATE, CUSTOMER_ID, AMOUNT) VALUES (693314358446550, DATE '1980-09-29', 10, 707654.7);
INSERT INTO INVOICE (INVOICE_ID, INVOICE_DATE, CUSTOMER_ID, AMOUNT) VALUES (690958228785712, DATE '1935-11-08', 16, 884662.17);
INSERT INTO INVOICE (INVOICE_ID, INVOICE_DATE, CUSTOMER_ID, AMOUNT) VALUES (566424530438907, DATE '1922-08-13', 17, 160513.18);
INSERT INTO INVOICE (INVOICE_ID, INVOICE_DATE, CUSTOMER_ID, AMOUNT) VALUES (209423667342898, DATE '2017-12-07', 11, 890140.0);
INSERT INTO INVOICE (INVOICE_ID, INVOICE_DATE, CUSTOMER_ID, AMOUNT) VALUES (446503939038120, DATE '2008-11-20', 13, 102930.69);
INSERT INTO INVOICE (INVOICE_ID, INVOICE_DATE, CUSTOMER_ID, AMOUNT) VALUES (931950090347385, DATE '1986-06-30', 13, 96074.0);
INSERT INTO INVOICE (INVOICE_ID, INVOICE_DATE, CUSTOMER_ID, AMOUNT) VALUES (750848544315503, DATE '1935-08-18', 16, 536818.71);
INSERT INTO INVOICE (INVOICE_ID, INVOICE_DATE, CUSTOMER_ID, AMOUNT) VALUES (356918891477121, DATE '2010-03-05', 17, 726690.69);
INSERT INTO INVOICE (INVOICE_ID, INVOICE_DATE, CUSTOMER_ID, AMOUNT) VALUES (521740547090156, DATE '1949-11-02', 15, 381011.34);
INSERT INTO INVOICE (INVOICE_ID, INVOICE_DATE, CUSTOMER_ID, AMOUNT) VALUES (894236299564063, DATE '1964-03-29', 16, 859738.39);
INSERT INTO INVOICE (INVOICE_ID, INVOICE_DATE, CUSTOMER_ID, AMOUNT) VALUES (127056430963774, DATE '2006-07-27', 18, 308630.19);
INSERT INTO INVOICE (INVOICE_ID, INVOICE_DATE, CUSTOMER_ID, AMOUNT) VALUES (254602153925022, DATE '2001-05-16', 15, 927621.08);
INSERT INTO INVOICE (INVOICE_ID, INVOICE_DATE, CUSTOMER_ID, AMOUNT) VALUES (220576634895812, DATE '1931-10-15', 18, 169015.75);
INSERT INTO INVOICE (INVOICE_ID, INVOICE_DATE, CUSTOMER_ID, AMOUNT) VALUES (798224649977922, DATE '1940-09-04', 19, 397182.0);
INSERT INTO INVOICE (INVOICE_ID, INVOICE_DATE, CUSTOMER_ID, AMOUNT) VALUES (549828405434268, DATE '1940-01-21', 10, 833880.92);
INSERT INTO INVOICE (INVOICE_ID, INVOICE_DATE, CUSTOMER_ID, AMOUNT) VALUES (836183140596346, DATE '1931-12-28', 15, 988975.14);
INSERT INTO INVOICE (INVOICE_ID, INVOICE_DATE, CUSTOMER_ID, AMOUNT) VALUES (630968928805024, DATE '1926-12-06', 13, 601799.0);
INSERT INTO INVOICE (INVOICE_ID, INVOICE_DATE, CUSTOMER_ID, AMOUNT) VALUES (178714523821669, DATE '1986-01-28', 14, 11724.2);
INSERT INTO INVOICE (INVOICE_ID, INVOICE_DATE, CUSTOMER_ID, AMOUNT) VALUES (158219394430335, DATE '1920-03-31', 16, 555224.77);
INSERT INTO INVOICE (INVOICE_ID, INVOICE_DATE, CUSTOMER_ID, AMOUNT) VALUES (465846558942458, DATE '1990-10-31', 13, 684199.05);
INSERT INTO INVOICE (INVOICE_ID, INVOICE_DATE, CUSTOMER_ID, AMOUNT) VALUES (443140862872818, DATE '1941-11-26', 18, 613542.48);
INSERT INTO INVOICE (INVOICE_ID, INVOICE_DATE, CUSTOMER_ID, AMOUNT) VALUES (235624047121468, DATE '1973-02-17', 10, 47435.81);
INSERT INTO INVOICE (INVOICE_ID, INVOICE_DATE, CUSTOMER_ID, AMOUNT) VALUES (780876376120827, DATE '1925-08-06', 17, 241578.32);
INSERT INTO INVOICE (INVOICE_ID, INVOICE_DATE, CUSTOMER_ID, AMOUNT) VALUES (167790929997130, DATE '2007-08-22', 15, 67726.47);
INSERT INTO INVOICE (INVOICE_ID, INVOICE_DATE, CUSTOMER_ID, AMOUNT) VALUES (674751423409906, DATE '1933-07-17', 13, 921885.0);
INSERT INTO INVOICE (INVOICE_ID, INVOICE_DATE, CUSTOMER_ID, AMOUNT) VALUES (722378022874415, DATE '1967-10-15', 18, 684468.79);
INSERT INTO INVOICE (INVOICE_ID, INVOICE_DATE, CUSTOMER_ID, AMOUNT) VALUES (183344194601637, DATE '1923-05-17', 15, 810267.17);
INSERT INTO INVOICE (INVOICE_ID, INVOICE_DATE, CUSTOMER_ID, AMOUNT) VALUES (973673003809622, DATE '1998-11-09', 14, 671702.79);
INSERT INTO INVOICE (INVOICE_ID, INVOICE_DATE, CUSTOMER_ID, AMOUNT) VALUES (144747911596089, DATE '1927-03-16', 12, 211679.0);
INSERT INTO INVOICE (INVOICE_ID, INVOICE_DATE, CUSTOMER_ID, AMOUNT) VALUES (596032886863338, DATE '1989-09-25', 13, 29546.32);
INSERT INTO INVOICE (INVOICE_ID, INVOICE_DATE, CUSTOMER_ID, AMOUNT) VALUES (762899096869417, DATE '1957-01-23', 16, 445938.35);
INSERT INTO INVOICE (INVOICE_ID, INVOICE_DATE, CUSTOMER_ID, AMOUNT) VALUES (845153386666743, DATE '2012-09-08', 15, 424421.37);
INSERT INTO INVOICE (INVOICE_ID, INVOICE_DATE, CUSTOMER_ID, AMOUNT) VALUES (409345977533084, DATE '2006-10-01', 15, 5799.2);
INSERT INTO INVOICE (INVOICE_ID, INVOICE_DATE, CUSTOMER_ID, AMOUNT) VALUES (148808757198100, DATE '1953-03-26', 17, 691131.22);
INSERT INTO INVOICE (INVOICE_ID, INVOICE_DATE, CUSTOMER_ID, AMOUNT) VALUES (116683816827820, DATE '1921-05-15', 17, 669819.14);
INSERT INTO INVOICE (INVOICE_ID, INVOICE_DATE, CUSTOMER_ID, AMOUNT) VALUES (104394731532049, DATE '1936-05-26', 19, 317191.97);
INSERT INTO INVOICE (INVOICE_ID, INVOICE_DATE, CUSTOMER_ID, AMOUNT) VALUES (827993222676352, DATE '1922-12-04', 16, 118163.86);
INSERT INTO INVOICE (INVOICE_ID, INVOICE_DATE, CUSTOMER_ID, AMOUNT) VALUES (807968778313352, DATE '1972-10-28', 15, 626285.98);
INSERT INTO INVOICE (INVOICE_ID, INVOICE_DATE, CUSTOMER_ID, AMOUNT) VALUES (915753517344014, DATE '1956-12-23', 11, 251876.03);
INSERT INTO INVOICE (INVOICE_ID, INVOICE_DATE, CUSTOMER_ID, AMOUNT) VALUES (503387533551738, DATE '1933-09-14', 19, 99521.88);
INSERT INTO INVOICE (INVOICE_ID, INVOICE_DATE, CUSTOMER_ID, AMOUNT) VALUES (444399393367659, DATE '1993-05-08', 13, 430594.2);
INSERT INTO INVOICE (INVOICE_ID, INVOICE_DATE, CUSTOMER_ID, AMOUNT) VALUES (850177650655750, DATE '1984-09-02', 15, 631895.76);
INSERT INTO INVOICE (INVOICE_ID, INVOICE_DATE, CUSTOMER_ID, AMOUNT) VALUES (219608458606432, DATE '1950-06-28', 16, 163694.87);
INSERT INTO INVOICE (INVOICE_ID, INVOICE_DATE, CUSTOMER_ID, AMOUNT) VALUES (777736737624969, DATE '2006-08-04', 15, 855856.12);
INSERT INTO INVOICE (INVOICE_ID, INVOICE_DATE, CUSTOMER_ID, AMOUNT) VALUES (544222347350482, DATE '1920-12-19', 17, 305485.87);
INSERT INTO INVOICE (INVOICE_ID, INVOICE_DATE, CUSTOMER_ID, AMOUNT) VALUES (737046312015613, DATE '1923-03-09', 19, 852890.47);
INSERT INTO INVOICE (INVOICE_ID, INVOICE_DATE, CUSTOMER_ID, AMOUNT) VALUES (200421689862141, DATE '1925-01-21', 13, 18210.97);
INSERT INTO INVOICE (INVOICE_ID, INVOICE_DATE, CUSTOMER_ID, AMOUNT) VALUES (798224385977922, DATE '2018-08-21', 19, 397182.0);
INSERT INTO INVOICE (INVOICE_ID, INVOICE_DATE, CUSTOMER_ID, AMOUNT) VALUES (549828890434268, DATE '2018-08-21', 10, 833880.92);
INSERT INTO INVOICE (INVOICE_ID, INVOICE_DATE, CUSTOMER_ID, AMOUNT) VALUES (798292785977922, DATE '2018-07-12', 13, 399082.0);
INSERT INTO INVOICE (INVOICE_ID, INVOICE_DATE, CUSTOMER_ID, AMOUNT) VALUES (549828890049268, DATE '2018-07-01', 15, 82280.92);
COMMIT;

-----------------------------------------------------------------
-- QUERIES
-----------------------------------------------------------------


-- E CREATE A QUERY WHICH SHOWS PURCHASES THAT OCCURRED TODAY 
SELECT *
FROM INVOICE
WHERE INVOICE_DATE = DATE '2018-08-21';

-- F CREATE A QUERY WHICH SHOWS EACH CUSTOMER AND THE NUMBER OF PURCHASES MADE BY EACH
SELECT CUSTOMER_ID, COUNT(INVOICE_ID) AS NUM_PURCHASES
FROM INVOICE
GROUP BY CUSTOMER_ID;

-- G CREATE A QUERY WHICH SHOWS EACH CUSTOMER AND THE TOTAL COST OF ALL THEIR PURCHASES
SELECT CUSTOMER_ID, SUM(AMOUNT) AS TOTAL_COST_OF_PURCHASES
FROM INVOICE
GROUP BY CUSTOMER_ID;

-- H CREATE A QUERY WHICH RETURNS ALL PURCHASES WHICH TOOK PLACE IN THE LAST MONTH
-- DISPLAY THEM IN DESCENDING ORDER
SELECT *
FROM INVOICE
WHERE INVOICE_DATE BETWEEN DATE '2018-07-01' AND DATE '2018-07-31'
ORDER BY INVOICE_DATE DESC;

-- I CREATE A QUERY WHICH SHOW THE TOP THREE MOST EXPENSIVE PURCHASES
SELECT * 
FROM INVOICE
ORDER BY AMOUNT DESC
FETCH NEXT 3 ROWS ONLY;

-------------------------------------------------------------------
-- WEDNESDAY EXERCISES
-------------------------------------------------------------------

-- A
SELECT *
FROM INVOICE I
JOIN CUSTOMER C
ON I.CUSTOMER_ID = C.CUSTOMER_ID;

-- B
SELECT *
FROM INVOICE I
RIGHT JOIN CUSTOMER C
ON I.CUSTOMER_ID = C.CUSTOMER_ID;

-- C has customer name in it
SELECT CUSTOMER_NAME, I.*
FROM INVOICE I
JOIN CUSTOMER C
ON I.CUSTOMER_ID = C.CUSTOMER_ID;

-- D
SELECT CUSTOMER_NAME, TOTAL_AMOUNT
FROM (
    SELECT I.CUSTOMER_ID, SUM(I.AMOUNT) AS TOTAL_AMOUNT
    FROM INVOICE I, CUSTOMER C
    WHERE  I.CUSTOMER_ID = C.CUSTOMER_ID
    GROUP BY I.CUSTOMER_ID) CUSTOMER_INVOICES
JOIN CUSTOMER CU
ON CUSTOMER_INVOICES.CUSTOMER_ID = CU.CUSTOMER_ID;

-- E
SELECT CUSTOMER.*
FROM (
    SELECT *
    FROM (
        SELECT *
        FROM INVOICE
        ORDER BY INVOICE_DATE DESC)
        WHERE ROWNUM = 1) MOST_RECENT
JOIN CUSTOMER
ON CUSTOMER.CUSTOMER_ID = MOST_RECENT.CUSTOMER_ID;

-- F
SELECT CUSTOMER_ID, AMOUNT, (AMOUNT - (0.06*AMOUNT)) AS SUBTOTAL
FROM INVOICE;